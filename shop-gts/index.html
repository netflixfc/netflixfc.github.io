<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Shop - GTS</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;padding:0;background:#f6f7fb}
    header{background:#0b5; padding:1rem 2rem; display:flex;justify-content:space-between;align-items:center}
    .brand{font-weight:700}
    .cart-badge{background:#111;color:#fff;padding:.35rem .6rem;border-radius:999px;font-weight:600}
    main{padding:2rem;max-width:1000px;margin:0 auto}
    .products{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem}
    .card{background:#fff;padding:1rem;border-radius:8px;box-shadow:0 2px 6px rgba(10,10,10,.06)}
    .price{font-size:1.25rem;font-weight:700;margin:0.5rem 0}
    .actions{display:flex;gap:.5rem}
    button{cursor:pointer;padding:.5rem .75rem;border-radius:6px;border:1px solid rgba(0,0,0,.08);background:#0b5;color:#fff}
    .secondary{background:#fff;color:#0b5;border:1px solid #0b5}
    footer{padding:2rem;text-align:center;color:#666}
  </style>
</head>
<body>
  <header>
    <div class="brand">GTS Store</div>
    <div>
      <span id="cartBadge" class="cart-badge">0 • THB 0.00</span>
      <button id="checkoutBtn" class="secondary" style="margin-left:8px">Checkout</button>
    </div>
  </header>
  <main>
    <h1>Available Products</h1>
    <div class="products" id="products"></div>
  </main>
  <footer>
    &copy; GTS - Prices shown in Thai Baht (THB)
  </footer>

  <script>
    // FX rate from USD to THB (example). Update this constant to change conversion.
    const FX_RATE = 36.50; // 1 USD = 36.50 THB

    // Format a number as Thai Baht currency
    function formatThb(amount) {
      // amount is expected in THB (number)
      return new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' }).format(amount);
    }

    // Sample product data using USD prices (original source currency)
    const productsData = [
      { id: 'gts-001', name: 'GTS Premium 1-Year', priceUsd: 9.99 },
      { id: 'gts-002', name: 'GTS 3-Month', priceUsd: 3.99 },
      { id: 'gts-003', name: 'GTS Lifetime', priceUsd: 49.99 }
    ];

    // Get cart from localStorage (cart items should store priceThb)
    function loadCart() {
      try {
        const raw = localStorage.getItem('gts_cart');
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.error('Failed to parse cart from storage', e);
        return [];
      }
    }

    function saveCart(cart) {
      localStorage.setItem('gts_cart', JSON.stringify(cart));
      updateBadge(cart);
    }

    // Add product to cart; store price in THB to keep checkout amounts consistent
    function addToCart(product) {
      const priceThb = Math.round(product.priceUsd * FX_RATE * 100) / 100; // two decimals
      const item = {
        id: product.id,
        name: product.name,
        priceUsd: product.priceUsd,
        priceThb: priceThb,
        qty: 1
      };

      const cart = loadCart();
      // merge if same id
      const existing = cart.find(i => i.id === item.id);
      if (existing) {
        existing.qty += 1;
      } else {
        cart.push(item);
      }
      saveCart(cart);
    }

    function getCartTotals(cart) {
      const count = cart.reduce((s, i) => s + i.qty, 0);
      const amountThb = cart.reduce((s, i) => s + i.priceThb * i.qty, 0);
      return { count, amountThb };
    }

    // Update badge with item count and total in THB
    function updateBadge(cart) {
      const { count, amountThb } = getCartTotals(cart);
      const badge = document.getElementById('cartBadge');
      badge.textContent = `${count} • ${formatThb(amountThb)}`;
    }

    // Build checkout link (example: a URL to external checkout) including THB amount
    function buildCheckoutLink(cart) {
      const { amountThb } = getCartTotals(cart);
      // Example checkout URL — replace with real payment processor if needed
      const base = 'https://example-checkout.local/checkout';
      const params = new URLSearchParams({ currency: 'THB', amount: amountThb.toFixed(2) });
      return `${base}?${params.toString()}`;
    }

    // On checkout, show confirmation with THB total and open checkout link
    function checkout() {
      const cart = loadCart();
      if (!cart.length) {
        alert('Your cart is empty.');
        return;
      }
      const { amountThb } = getCartTotals(cart);
      const confirmation = `You will be charged ${formatThb(amountThb)} (THB) for ${cart.reduce((s,i)=>s+i.qty,0)} item(s). Proceed to checkout?`;
      if (confirm(confirmation)) {
        const url = buildCheckoutLink(cart);
        // For demonstration open the checkout URL in a new tab
        window.open(url, '_blank');
      }
    }

    // Render product list and price converted to THB
    function renderProducts() {
      const container = document.getElementById('products');
      container.innerHTML = '';
      for (const p of productsData) {
        const priceThb = Math.round(p.priceUsd * FX_RATE * 100) / 100;
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${p.name}</h3>
          <div class="price">${formatThb(priceThb)}</div>
          <div>Original: $${p.priceUsd.toFixed(2)} USD</div>
          <div class="actions" style="margin-top:.75rem">
            <button class="add">Add to cart</button>
            <button class="buy secondary">Buy now</button>
          </div>
        `;
        card.querySelector('.add').addEventListener('click', () => addToCart(p));
        card.querySelector('.buy').addEventListener('click', () => {
          addToCart(p);
          // Immediately checkout for this item
          setTimeout(() => checkout(), 150);
        });
        container.appendChild(card);
      }
    }

    // Initialize
    (function init() {
      renderProducts();
      updateBadge(loadCart());
      document.getElementById('checkoutBtn').addEventListener('click', checkout);
    })();
  </script>
</body>
</html>
