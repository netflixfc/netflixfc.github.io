<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Payment - Shop GTS</title>
  <style>
    body { font-family: system-ui, -apple-system, Roboto, "Helvetica Neue", Arial; margin: 0; padding: 20px; background: #f7f7f8; color: #222; }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { margin-top: 0; }
    .top { display: flex; gap: 20px; align-items: start; }
    .card { background: #fff; padding: 18px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.06); flex: 1; }
    .canvas-wrap { width: 360px; height: 220px; }
    canvas { display: block; width: 100%; height: 100%; border-radius: 6px; }
    form { display: grid; gap: 10px; margin-top: 12px; }
    label { font-size: 13px; color: #444; }
    input[type="text"], input[type="email"], input[type="tel"] { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd; }
    button { padding: 10px 14px; border: none; border-radius: 6px; background: #1f7aec; color: #fff; cursor: pointer; }
    @media (max-width: 720px) { .top { flex-direction: column; } .canvas-wrap { width: 100%; height: 200px; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Complete Payment</h1>
    <div class="top">
      <div class="card canvas-wrap">
        <canvas id="cardCanvas" aria-hidden="true"></canvas>
      </div>
      <div class="card">
        <form id="paymentForm" novalidate>
          <div>
            <label for="name">Name on card</label>
            <input id="name" name="name" type="text" placeholder="Jane Doe" required>
          </div>
          <div>
            <label for="number">Card number</label>
            <input id="number" name="number" type="text" placeholder="•••• •••• •••• 4242" inputmode="numeric" required>
          </div>
          <div style="display:flex; gap:10px;">
            <div style="flex:1">
              <label for="exp">Expiry</label>
              <input id="exp" name="exp" type="text" placeholder="MM/YY" required>
            </div>
            <div style="width:110px">
              <label for="cvc">CVC</label>
              <input id="cvc" name="cvc" type="text" placeholder="123" inputmode="numeric" required>
            </div>
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="jane@example.com">
          </div>
          <div style="margin-top:8px; text-align:right;">
            <button type="submit">Pay</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Helper: scale canvas for high DPI / Retina displays
    function scaleCanvasForDPR(canvas) {
      const ctx = canvas.getContext('2d');
      // Get the size the canvas is displayed at (CSS pixels)
      const rect = canvas.getBoundingClientRect();
      // devicePixelRatio (DPR) may be fractional; use at least 1
      const dpr = Math.max(window.devicePixelRatio || 1, 1);

      // Avoid unnecessary reallocation if sizes are already correct
      const width = Math.round(rect.width * dpr);
      const height = Math.round(rect.height * dpr);

      if (canvas.width !== width || canvas.height !== height) {
        canvas.width = width;
        canvas.height = height;
        // Keep the CSS size as logical pixels
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';
        // Scale the drawing context so 1 unit = 1 CSS pixel
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      } else {
        // Ensure transform matches DPR in case of dynamic DPR changes
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }

      return ctx;
    }

    function drawCard(canvas) {
      const ctx = scaleCanvasForDPR(canvas);
      // Clear with rounded rect background
      const w = canvas.width / (window.devicePixelRatio || 1);
      const h = canvas.height / (window.devicePixelRatio || 1);

      // Clear
      ctx.clearRect(0, 0, w, h);

      // Background gradient
      const g = ctx.createLinearGradient(0, 0, w, h);
      g.addColorStop(0, '#1f7aec');
      g.addColorStop(1, '#2ec7a7');

      const radius = 12;
      ctx.fillStyle = g;
      roundRect(ctx, 0.5, 0.5, w - 1, h - 1, radius, true, false);

      // Card chip
      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      ctx.fillRect(24, 36, 48, 34);

      // Card number placeholder
      ctx.fillStyle = 'rgba(255,255,255,0.95)';
      ctx.font = Math.round(h * 0.12) + 'px system-ui, -apple-system, Roboto, "Helvetica Neue", Arial';
      ctx.fillText('•••• •••• •••• 4242', 24, Math.round(h * 0.62));

      // Name placeholder
      ctx.font = Math.round(h * 0.09) + 'px system-ui, -apple-system, Roboto, "Helvetica Neue", Arial';
      ctx.fillText('JANE DOE', 24, Math.round(h * 0.82));

      // Logo
      ctx.beginPath();
      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      ctx.arc(w - 36, h - 48, 14, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.fillStyle = 'rgba(255,255,255,0.55)';
      ctx.arc(w - 20, h - 48, 14, 0, Math.PI * 2);
      ctx.fill();
    }

    // Rounded rectangle helper
    function roundRect(ctx, x, y, width, height, r, fill, stroke) {
      if (typeof r === 'undefined') r = 5;
      if (typeof r === 'number') r = {tl: r, tr: r, br: r, bl: r};
      ctx.beginPath();
      ctx.moveTo(x + r.tl, y);
      ctx.lineTo(x + width - r.tr, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + r.tr);
      ctx.lineTo(x + width, y + height - r.br);
      ctx.quadraticCurveTo(x + width, y + height, x + width - r.br, y + height);
      ctx.lineTo(x + r.bl, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - r.bl);
      ctx.lineTo(x, y + r.tl);
      ctx.quadraticCurveTo(x, y, x + r.tl, y);
      ctx.closePath();
      if (fill) ctx.fill();
      if (stroke) ctx.stroke();
    }

    (function init() {
      const canvas = document.getElementById('cardCanvas');
      if (!canvas) return;

      // First draw on load
      function render() {
        drawCard(canvas);
      }

      // Initial render once DOM is ready
      render();

      // Resize observer to handle layout/CSS size changes responsively
      const ro = new ResizeObserver(entries => {
        for (const entry of entries) {
          if (entry.target === canvas) {
            render();
          }
        }
      });
      ro.observe(canvas);

      // Also re-render on window resize and DPR changes
      window.addEventListener('resize', render, { passive: true });
      // Some browsers fire a 'change' on matchMedia when DPR changes (experimental), listen to it if available
      if (window.matchMedia) {
        const mq = window.matchMedia('(resolution: ' + (window.devicePixelRatio || 1) + 'dppx)');
        try {
          if (mq && typeof mq.addEventListener === 'function') {
            mq.addEventListener('change', render);
          }
        } catch (e) {
          // ignore if not supported
        }
      }

      // Basic form handling (no debug logs)
      const form = document.getElementById('paymentForm');
      form.addEventListener('submit', function (evt) {
        evt.preventDefault();
        // Perform form validation / submit to payment endpoint here
        // For security, never log payment details in production
        const data = new FormData(form);
        const payload = {
          name: data.get('name') || '',
          number: data.get('number') || '',
          exp: data.get('exp') || '',
          cvc: data.get('cvc') || '',
          email: data.get('email') || ''
        };
        // TODO: send payload to server via fetch/POST
        alert('Payment submission triggered — implement server-side handling.');
      });
    })();
  </script>
</body>
</html>